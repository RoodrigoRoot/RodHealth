{% extends 'base.html' %}
{% load crispy_forms_tags %}
{% block title %}
Crear Paciente
{% endblock %}

{%  block content %}
  
  <div class="container">
    <form method="POST" id="form_create_patient">{% csrf_token %}
        {{second_form|crispy}}
        {{form|crispy}}
        <label for="id_date">Hora y fecha*</label>
        <div class="input-group date" id="picker_appoiment" data-target-input="nearest">
          {{form.date_birth}}
          <div class="input-group-append" data-target="#picker_appoiment" data-toggle="datetimepicker">
            <div class="input-group-text"><i class="fa fa-calendar"></i></div>
          </div>
        </div>
        <input type="submit" value="Agregar" class="btn btn-success">
    </form>
</div>

<script src="https://code.jquery.com/jquery-3.5.1.min.js"
		integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="
		crossorigin="anonymous"></script>

<script>
    $(function () {
    $("#datetimepicker1").datetimepicker({
      format: 'DD/MM/YYYY HH:mm',
    });
  });


  $("form").on("submit",function(e){
    e.preventDefault()
    var data = $("#form_create_patient").serializeArray()
    $.ajax({
      url: window.location.href,
      method:'POST',
      data:data,
      dataType: 'json',
    }).done(function(data){
      if (!data.hasOwnProperty('errors')){
        Swal.fire({
                title:'¡Éxito!',
                icon:'success',
                text:'Puedes verlo en la lista de pacientes',
                html: "<a href='{% url 'list_patients' %}'>Ver pacientes</a>",
                confirmButtonText: 'Aceptar',
        }
                )
              return false;
            }
            message_error(data.errors)
  }).fail(function(XHR,textStatus, erroThown){
    console.log(XHR)
      Swal.fire({
        icon: 'error',
        title: 'Oops...',
        text: textStatus+" "+erroThown,
        
      })

    })
  })


</script>
{% endblock%}